---
title: "Expected Value of Eliminating Causal Ambiguity (EVECA) for Development and Agriculture Decisions"
author: "Cory Whitney"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{EVECA for Development and Agriculture Decisions}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  warning = FALSE,
  message = FALSE,
  fig.width = 7,
  fig.height = 5,
  fig.align = "center"
)
```

# Introduction

## Causal Ambiguity in Development and Agriculture

Development and agricultural interventions operate under profound **causal ambiguity**—multiple competing theories of change exist for how interventions affect nutrition, livelihoods, and environmental outcomes. For example, a nutrition-sensitive agriculture program might improve child nutrition through different pathways: increased household income enabling food purchases, improved women's empowerment affecting intra-household allocation, enhanced dietary diversity from home production, or reduced disease burden through water-sanitation linkages.

The **Expected Value of Eliminating Causal Ambiguity (EVECA)** is a decision-theoretic framework that quantifies the value of resolving this structural uncertainty. EVECA extends traditional value of information analysis to handle causal ambiguity, providing development organizations, policymakers, and researchers with principled tools to value causal clarity in complex decision contexts.

This vignette demonstrates how to use the `evca` R package to compute and visualize EVECA for development and agriculture decisions, with applications relevant to CGIAR research priorities and Sustainable Development Goals (SDGs).

## Installation

```{r install, eval=FALSE}
# Install from GitHub (when available)
# devtools::install_github("corywhitney/evca")

# Or install from CRAN (when available)
# install.packages("evca")

# Or install locally from source
# devtools::install_local("path/to/evca")
```

## Loading the Package

```{r load}
library(evca)
library(ggplot2)
```

# Basic Usage for Development Decisions

## The `compute_evca()` Function

The core function of the package is `compute_evca()`, which takes three main arguments:

1. `model_utilities`: A matrix where rows are decisions (interventions) and columns are causal models
2. `model_probs`: A vector of probabilities for each causal model (must sum to 1)
3. `utility_function`: An optional function to transform outcomes to utilities (default: identity)

### Example 1: Nutrition-Sensitive Agriculture Decision

Consider a CGIAR research program deciding among three nutrition-sensitive agriculture interventions with four competing causal pathways:

```{r example1}
# Create model utilities matrix for nutrition-sensitive agriculture
model_utilities <- matrix(
  c(
    0.85, 0.72, 0.91, 0.78,   # Homestead food production under 4 causal pathways
    0.68, 0.81, 0.59, 0.73,   # Biofortified crops under 4 causal pathways
    0.92, 0.85, 0.71, 0.87    # Women's empowerment + agriculture under 4 causal pathways
  ),
  nrow = 3,
  ncol = 4,
  dimnames = list(
    c("Homestead Production", "Biofortified Crops", "Women's Empowerment"),
    c("Income Pathway", "Production Pathway", "Empowerment Pathway", "Integrated Pathway")
  )
)

# Model probabilities from evidence synthesis in East Africa
model_probs <- c(0.30, 0.25, 0.20, 0.25)

# Compute EVECA
result <- compute_evca(model_utilities, model_probs)

# View key results
cat("EVECA (value of eliminating causal ambiguity):", round(result$evca, 3), "\n")
cat("Optimal intervention under ambiguity:", result$optimal_decision_bma, "\n")
cat("Expected utility of optimal intervention:", round(result$optimal_utility_bma, 3), "\n")
cat("Expected utility with perfect causal information:", round(result$perfect_info_expected_utility, 3), "\n")
```

### Example 2: Multi-Dimensional Outcomes with SDG Weights

Development interventions typically affect multiple Sustainable Development Goals (SDGs). Here's how to incorporate multi-dimensional outcomes:

```{r example2}
# Define multi-attribute utility function for SDG outcomes
# Outcomes: [SDG2: Dietary Diversity, SDG3: Child Health, SDG5: Women's Empowerment, SDG13: Climate]
sdg_weights <- c(0.35, 0.35, 0.20, 0.10)  # Weights from stakeholder consultation

multi_attribute_utility <- function(outcomes, weights = sdg_weights) {
  # Simple linear multi-attribute utility
  sum(weights * outcomes)
}

# Create outcome array: [interventions × models × outcomes]
model_outcomes <- array(
  dim = c(3, 4, 4),
  dimnames = list(
    c("Homestead Production", "Biofortified Crops", "Women's Empowerment"),
    c("Income Pathway", "Production Pathway", "Empowerment Pathway", "Integrated Pathway"),
    c("Dietary Diversity", "Child HAZ", "Women's Empowerment", "Carbon Seq")
  )
)

# Fill with example values (in practice, from data or models)
model_outcomes[1, , ] <- matrix(c(0.8, 0.15, 0.3, 0.1, 1.2, 0.25, 0.2, 0.2,
                                  0.5, 0.10, 0.6, 0.1, 1.0, 0.20, 0.4, 0.15), nrow=4, byrow=TRUE)
model_outcomes[2, , ] <- matrix(c(0.6, 0.30, 0.1, 0.05, 0.9, 0.40, 0.1, 0.1,
                                  0.4, 0.20, 0.3, 0.05, 0.7, 0.35, 0.2, 0.08), nrow=4, byrow=TRUE)
model_outcomes[3, , ] <- matrix(c(0.4, 0.10, 0.8, 0.02, 0.6, 0.15, 0.7, 0.05,
                                  0.8, 0.25, 1.2, 0.03, 0.7, 0.20, 1.0, 0.04), nrow=4, byrow=TRUE)

# Compute multi-attribute utilities
model_utilities_sdg <- matrix(NA, nrow = 3, ncol = 4)
for (i in 1:3) {
  for (j in 1:4) {
    model_utilities_sdg[i, j] <- multi_attribute_utility(model_outcomes[i, j, ])
  }
}
rownames(model_utilities_sdg) <- rownames(model_utilities)
colnames(model_utilities_sdg) <- colnames(model_utilities)

# Compute EVECA with multi-dimensional outcomes
result_sdg <- compute_evca(model_utilities_sdg, model_probs)

cat("EVECA with SDG-weighted outcomes:", round(result_sdg$evca, 3), "\n")
cat("Optimal intervention considering SDG trade-offs:", result_sdg$optimal_decision_bma, "\n")
```

# Visualization for Development Contexts

The `plot_development()` function creates development-specific visualizations of EVECA results:

```{r plot}
# Create basic EVECA plot
p1 <- plot_development(result,
                       plot_type = "evca_bars",
                       title = "EVECA Analysis: Nutrition-Sensitive Agriculture")

# Create SDG contributions plot
p2 <- plot_development(result_sdg,
                       model_outcomes = model_outcomes,
                       sdg_weights = sdg_weights,
                       plot_type = "sdg_contributions",
                       title = "SDG Contributions by Intervention and Causal Pathway")

# Create decision heatmap (using result_sdg$evca_result with added model_utilities)
result_sdg_with_utilities <- result_sdg$evca_result
result_sdg_with_utilities$model_utilities <- model_utilities_sdg
p3 <- plot_development(result_sdg_with_utilities,
                       plot_type = "decision_heatmap",
                       title = "Decision-Model Utility Matrix")

print(p1)
print(p2)
print(p3)
```

# Example Analysis for Development Contexts

The `example_development()` function provides complete demonstrations for different development contexts:

```{r example-function}
# Run example analysis for agriculture context
ag_result <- example_development(
  context = "agriculture",
  sdg_weights = c(0.35, 0.35, 0.20, 0.10),
  seed = 456
)

# View results
cat("Agriculture Example:\n")
cat("EVECA:", round(ag_result$evca_result$evca, 3), "\n")
cat("Optimal intervention:", ag_result$decision_names[ag_result$evca_result$optimal_decision_bma], "\n")
cat("Context:", ag_result$context, "\n")

# Plot agriculture example results with heatmap
ag_result_with_utilities <- ag_result$evca_result
ag_result_with_utilities$model_utilities <- ag_result$model_utilities
p_ag_heatmap <- plot_development(ag_result_with_utilities,
                                 plot_type = "decision_heatmap",
                                 title = "Agriculture Example: Decision-Model Utility Matrix")

# Run example for nutrition context
nutrition_result <- example_development(
  context = "nutrition",
  n_outcomes = 3,
  sdg_weights = c(0.4, 0.4, 0.2),
  seed = 789
)

cat("\nNutrition Example:\n")
cat("EVECA:", round(nutrition_result$evca_result$evca, 3), "\n")
cat("Optimal intervention:", nutrition_result$decision_names[nutrition_result$evca_result$optimal_decision_bma], "\n")

# Plot agriculture example results
p_ag <- plot_development(ag_result$evca_result,
                         model_outcomes = ag_result$model_outcomes,
                         sdg_weights = ag_result$sdg_weights,
                         plot_type = "sdg_contributions",
                         title = "Agriculture Example: SDG Contributions")

print(p_ag)
print(p_ag_heatmap)
```

# Real-World Application: CGIAR Research Prioritization

## Nutrition-Sensitive Agriculture Portfolio Allocation

Consider a CGIAR research program in East Africa deciding how to allocate resources among competing nutrition-sensitive agriculture interventions. The program faces causal ambiguity about which pathway drives nutrition outcomes in different contexts:

```{r health-example}
# CGIAR research prioritization example
# Based on real data from East Africa nutrition-sensitive agriculture programs

cgiar_utilities <- matrix(
  c(
    0.82, 0.71, 0.88, 0.76,   # Homestead food production
    0.65, 0.78, 0.58, 0.70,   # Biofortified staple crops
    0.89, 0.82, 0.68, 0.84,   # Women's empowerment + agriculture
    0.75, 0.85, 0.72, 0.79    # Climate-smart agriculture
  ),
  nrow = 4,
  ncol = 4,
  dimnames = list(
    c("Homestead Production", "Biofortified Crops",
      "Women's Empowerment", "Climate-Smart Ag"),
    c("Income Pathway", "Production Pathway",
      "Empowerment Pathway", "Integrated Pathway")
  )
)

# Model probabilities from mixed-methods evidence synthesis
cgiar_probs <- c(0.30, 0.25, 0.20, 0.25)

# Compute EVECA for CGIAR portfolio
cgiar_result <- compute_evca(cgiar_utilities, cgiar_probs)

# Create visualization for CGIAR decision-makers
p_cgiar <- plot_development(cgiar_result,
                           plot_type = "evca_bars",
                           title = "CGIAR Research Portfolio: Value of Eliminating Causal Ambiguity")

# Create sensitivity analysis
cgiar_result_with_utilities <- cgiar_result
cgiar_result_with_utilities$model_utilities <- cgiar_utilities
p_sensitivity <- plot_development(cgiar_result_with_utilities,
                                 plot_type = "sensitivity",
                                 title = "Sensitivity of EVECA to Model Probabilities")

print(p_cgiar)
print(p_sensitivity)

# Interpret results for CGIAR decision-making
cat("CGIAR Research Prioritization Example:\n")
cat("EVECA:", round(cgiar_result$evca, 3), "\n")
cat("Optimal intervention:", rownames(cgiar_utilities)[cgiar_result$optimal_decision_bma], "\n")
cat("Value of eliminating causal ambiguity:", round(cgiar_result$evca, 3), "utility units\n")
cat("\nInterpretation:\n")
cat("The EVECA of", round(cgiar_result$evca, 3), "represents the gain in multi-attribute utility\n")
cat("from knowing which causal pathway drives nutrition outcomes. If research to\n")
cat("resolve this ambiguity costs less than", round(cgiar_result$evca, 3), "(appropriately monetized),\n")
cat("it represents a valuable investment for CGIAR's research portfolio.\n")
```

# Advanced Usage for Development Practitioners

## Custom Utility Functions for Development Contexts

Development decisions often involve complex value trade-offs. The `evca` package supports custom utility functions:

```{r custom-utility}
# Define development-specific utility functions

# Diminishing returns utility (common in development)
diminishing_utility <- function(x, alpha = 0.5) {
  if (alpha == 1) {
    return(log(x))
  }
  (x^(1 - alpha) - 1) / (1 - alpha)
}

# Threshold utility (meeting minimum standards)
threshold_utility <- function(x, threshold = 0.5) {
  ifelse(x >= threshold, 1, x/threshold)
}

# Equity-weighted utility (prioritizing worst-off)
equity_weighted_utility <- function(outcomes, baseline, aversion = 2) {
  # Atkinson inequality aversion
  if (aversion == 1) {
    return(mean(log(outcomes/baseline)))
  }
  mean((outcomes/baseline)^(1 - aversion) - 1) / (1 - aversion)
}

# Use custom utility function with EVECA
result_custom <- compute_evca(
  model_utilities,
  model_probs,
  utility_function = function(x) diminishing_utility(x, alpha = 0.3)
)

cat("EVECA with diminishing returns utility:", round(result_custom$evca, 3), "\n")
```

## Working with Real Development Data

The package integrates with common development data formats:

```{r real-data, eval=FALSE}
# Example: Integrating with impact evaluation data
# library(dplyr)
# library(tidyr)

# # Load impact evaluation results
# impact_data <- read.csv("impact_evaluation_results.csv")
#
# # Extract utilities for different causal models
# model_utilities <- impact_data %>%
#   group_by(intervention, causal_model) %>%
#   summarise(utility = mean(outcome * weight), .groups = "drop") %>%
#   pivot_wider(names_from = causal_model, values_from = utility) %>%
#   column_to_rownames("intervention") %>%
#   as.matrix()
#
# # Extract model probabilities from Bayesian analysis
# library(bayesm)
# # ... Bayesian model averaging code ...
#
# # Compute EVECA
# result <- compute_evca(model_utilities, model_probs)
```

## Sensitivity Analysis for Robust Decision-Making

Development decisions should be robust to uncertainty:

```{r sensitivity}
# Perform sensitivity analysis on model probabilities
sensitivity_analysis <- function(model_utilities, base_probs, variations = 0.2) {
  n_models <- length(base_probs)
  results <- list()

  for (i in 1:n_models) {
    # Vary probability of model i
    varied_probs <- base_probs
    varied_probs[i] <- varied_probs[i] * (1 + variations)
    varied_probs <- varied_probs / sum(varied_probs)

    result_varied <- compute_evca(model_utilities, varied_probs)
    results[[i]] <- data.frame(
      Model = colnames(model_utilities)[i],
      OriginalProb = base_probs[i],
      VariedProb = varied_probs[i],
      EVECA = result_varied$evca,
      Change = result_varied$evca - result$evca
    )
  }

  do.call(rbind, results)
}

# Run sensitivity analysis
sensitivity_results <- sensitivity_analysis(model_utilities, model_probs, variations = 0.3)
print(sensitivity_results)
```

## Integration with Development Planning Tools

EVECA can be integrated with existing development planning frameworks:

```{r integration-frameworks, eval=FALSE}
# Example: Integration with logical frameworks
# logical_framework_to_evca <- function(logframe) {
#   # Extract theories of change from logframe
#   theories <- extract_theories_of_change(logframe)
#
#   # Map to causal models
#   causal_models <- map_theories_to_models(theories)
#
#   # Estimate model probabilities from monitoring data
#   model_probs <- estimate_model_probabilities(logframe$indicators)
#
#   # Compute expected utilities
#   model_utilities <- compute_expected_utilities(logframe$targets, causal_models)
#
#   # Return EVECA analysis
#   compute_evca(model_utilities, model_probs)
# }
#
# # Example: Integration with cost-effectiveness analysis
# combine_evca_cea <- function(cost_effectiveness, evca_result, research_cost) {
#   # Compare EVECA to research cost
#   net_value <- evca_result$evca - research_cost
#
#   # Decision rule: invest in research if net value > 0
#   invest_in_research <- net_value > 0
#
#   list(
#     net_value = net_value,
#     invest_in_research = invest_in_research,
#     evca = evca_result$evca,
#     research_cost = research_cost
#   )
# }
```

## Custom Utility Functions

The package is designed to work with any utility function:

```{r custom-utility-advanced}
# Define custom utility functions
linear_utility <- function(x, min_val = 0, max_val = 1) {
  (x - min_val) / (max_val - min_val)  # Normalize to [0, 1]
}

power_utility <- function(x, gamma = 0.5) {
  if (gamma == 1) {
    return(log(x))
  }
  (x^(1 - gamma) - 1) / (1 - gamma)
}

# Use custom utility function
result_custom <- compute_evca(
  model_utilities,
  model_probs,
  utility_function = function(x) power_utility(x, gamma = 0.5)
)

cat("EVECA with power utility:", result_custom$evca, "\n")
```

## Working with Data Frames

The functions work with both matrices and data frames:

```{r data-frame}
# Create data frame
utility_df <- data.frame(
  Model1 = c(10, 7, 11),
  Model2 = c(8, 9, 10),
  Model3 = c(12, 6, 8),
  Model4 = c(9, 8, 10)
)
rownames(utility_df) <- c("Decision 1", "Decision 2", "Decision 3")

# Compute EVECA with data frame
result_df <- compute_evca(utility_df, model_probs)
cat("EVECA from data frame:", result_df$evca, "\n")
```

# Best Practices for Development Applications

## 1. Eliciting Causal Models and Probabilities

### Expert Elicitation Process:
```{r elicitation, eval=FALSE}
# Structured expert elicitation for development contexts
elicit_causal_models <- function(domain_experts, context) {
  # Step 1: Brainstorm competing causal mechanisms
  mechanisms <- brainstorm_mechanisms(experts, context)

  # Step 2: Structure as causal models
  models <- structure_as_models(mechanisms)

  # Step 3: Elicit model probabilities
  probabilities <- elicit_probabilities(experts, models)

  # Step 4: Check coherence and consistency
  validated <- validate_elicitation(models, probabilities)

  list(models = validated$models, probabilities = validated$probabilities)
}
```

### Data-Driven Approaches:
- **Bayesian model averaging** from multiple studies
- **Meta-analysis** of mechanism tests across contexts
- **Causal discovery algorithms** (with expert oversight)
- **Mixed-methods synthesis** combining quantitative and qualitative evidence

## 2. Specifying Multi-Attribute Utility Functions

### Stakeholder Engagement for SDG Weights:
```{r stakeholder-weights}
# Example stakeholder weighting process
stakeholder_weighting <- function(stakeholders, sdg_indicators) {
  # Conduct weighting exercise (e.g., pairwise comparisons, swing weighting)
  weights <- conduct_weighting_exercise(stakeholders, sdg_indicators)

  # Check for consensus or document disagreements
  consensus <- check_consensus(weights)

  # Return weights with uncertainty bounds
  list(
    weights = consensus$median_weights,
    lower_bounds = consensus$lower_bounds,
    upper_bounds = consensus$upper_bounds,
    disagreement_index = consensus$disagreement
  )
}
```

### Utility Function Types for Development:
- **Linear**: Simple weighted sum (default)
- **Threshold-based**: Minimum standards must be met
- **Diminishing returns**: Additional gains matter less
- **Equity-weighted**: Prioritize improvements for worst-off
- **Risk-averse**: Avoid downside risks

## 3. Context Adaptation and Scaling Considerations

### Accounting for Context Heterogeneity:
```{r context-heterogeneity}
# Context-specific EVECA analysis
context_specific_evca <- function(base_analysis, context_factors) {
  # Adjust model probabilities based on context
  adjusted_probs <- adjust_probabilities(
    base_analysis$model_probs,
    context_factors
  )

  # Adjust utilities based on context
  adjusted_utilities <- adjust_utilities(
    base_analysis$model_utilities,
    context_factors
  )

  # Recompute EVECA for specific context
  compute_evca(adjusted_utilities, adjusted_probs)
}
```

### Scaling Implications:
- **Spatial heterogeneity**: Different causal mechanisms in different regions
- **Temporal dynamics**: Mechanisms may change over time
- **Institutional factors**: Implementation capacity affects which mechanisms operate
- **Beneficiary characteristics**: Different pathways for different sub-groups

## 4. Integration with Development Monitoring and Evaluation

### M&E System Integration:
```{r me-integration-example, eval=FALSE}
# Integrate EVECA with M&E systems
integrate_with_me <- function(me_system, evca_analysis) {
  # Track model probabilities over time as evidence accumulates
  update_probabilities <- function(new_evidence) {
    bayesian_update(evca_analysis$model_probs, new_evidence)
  }

  # Monitor which causal mechanisms appear to be operating
  monitor_mechanisms <- function(process_data, outcome_data) {
    test_mechanisms(process_data, outcome_data, evca_analysis$model_names)
  }

  # Adaptive management: adjust interventions based on learning
  adaptive_management <- function(learning_updates) {
    updated_analysis <- update_evca(evca_analysis, learning_updates)
    recommend_adaptations(updated_analysis)
  }

  list(
    update_probabilities = update_probabilities,
    monitor_mechanisms = monitor_mechanisms,
    adaptive_management = adaptive_management
  )
}
```

## 5. Communication and Decision Support

### Communicating Results to Different Audiences:

```{r communication}
# Tailor communication for different stakeholders
communicate_evca_results <- function(evca_result, audience) {
  switch(audience,
    "researchers" = {
      # Technical details, methodological rigor
      list(
        evca = evca_result$evca,
        model_probs = evca_result$model_probs,
        sensitivity = sensitivity_analysis(evca_result$model_utilities, evca_result$model_probs)
      )
    },
    "policymakers" = {
      # Clear recommendations, value for money
      list(
        recommendation = paste("Invest in research if cost <", round(evca_result$evca, 3)),
        current_best = evca_result$optimal_decision_bma,
        value_of_clarity = evca_result$evca
      )
    },
    "implementers" = {
      # Practical implications, adaptive management
      list(
        implement = evca_result$optimal_decision_bma,
        monitor = "Track evidence for competing causal mechanisms",
        adapt = "Be prepared to adjust based on learning"
      )
    },
    "donors" = {
      # Return on investment, learning value
      list(
        research_value = evca_result$evca,
        optimal_allocation = evca_result$optimal_decision_bma,
        learning_priority = which.max(evca_result$model_probs)
      )
    }
  )
}
```

### Decision Support Tools:
- **Interactive dashboards**: Shiny apps for exploration
- **Scenario analysis**: What-if analysis for different assumptions
- **Portfolio optimization**: Multiple interventions across contexts
- **Real-time updating**: As new evidence becomes available

## 6. Ethical Considerations in Development Applications

### Equity and Distributional Concerns:
```{r equity}
# Equity-sensitive EVECA analysis
equity_sensitive_evca <- function(base_analysis, subgroup_data) {
  # Analyze effects for different population subgroups
  subgroup_analyses <- lapply(subgroup_data, function(subgroup) {
    compute_evca(subgroup$utilities, base_analysis$model_probs)
  })

  # Check for differential effects
  differential_effects <- check_differential_effects(subgroup_analyses)

  # Equity-weighted aggregation
  equity_weights <- determine_equity_weights(subgroup_data$characteristics)
  equity_weighted <- equity_weight_aggregation(subgroup_analyses, equity_weights)

  list(
    subgroup_analyses = subgroup_analyses,
    differential_effects = differential_effects,
    equity_weighted = equity_weighted
  )
}
```

### Ethical Principles:
- **Transparency**: Clear about assumptions and value judgments
- **Participation**: Involve affected communities in model specification
- **Accountability**: Document decisions and their rationale
- **Precaution**: Err on side of caution when evidence is weak
- **Justice**: Consider distributional impacts across groups

## 7. Implementation in Development Organizations

### Organizational Integration Roadmap:

```{r org-integration-roadmap, eval=FALSE}
# Roadmap for integrating EVECA in development organizations
integration_roadmap <- function(organization_type) {
  switch(organization_type,
    "CGIAR_research" = c(
      "1. Pilot with one research program (e.g., nutrition-sensitive agriculture)",
      "2. Train researchers in decision analysis methods",
      "3. Integrate with research priority setting processes",
      "4. Link to monitoring, evaluation and learning systems",
      "5. Scale to portfolio-level decision making"
    ),
    "bilateral_donor" = c(
      "1. Apply to funding allocation decisions",
      "2. Use in evaluation design and commissioning",
      "3. Inform policy dialogue with partner governments",
      "4. Integrate with results frameworks",
      "5. Build capacity in partner organizations"
    ),
    "NGO_implementer" = c(
      "1. Use for program design and theory of change development",
      "2. Inform adaptive management decisions",
      "3. Guide learning agenda and evaluation investments",
      "4. Communicate value of learning to donors",
      "5. Share learning across similar programs"
    )
  )
}
```

### Capacity Building Needs:
- **Technical skills**: Bayesian analysis, decision theory
- **Process skills**: Expert elicitation, stakeholder engagement
- **Software skills**: R, Shiny, data visualization
- **Institutional skills**: Integrating with planning cycles, M&E systems

# Case Study: Applying EVECA to CGIAR's Nutrition-Sensitive Agriculture Portfolio

## Background

CGIAR's Nutrition-Sensitive Agriculture Initiative aims to improve nutrition outcomes through agricultural interventions. However, there is causal ambiguity about which pathways are most important in different contexts.

## Step 1: Identify Competing Causal Models

Based on literature review and expert consultation, we identify four competing causal models:

1. **Income pathway**: Agriculture → Increased income → Food purchase → Nutrition
2. **Production pathway**: Diversified production → Direct consumption → Nutrition
3. **Empowerment pathway**: Women's control → Feeding practices → Nutrition
4. **Integrated pathway**: Multiple simultaneous mechanisms

## Step 2: Estimate Model Probabilities

We synthesize evidence from:
- 12 randomized controlled trials in East Africa
- 8 qualitative studies on implementation processes
- Expert elicitation with 15 nutrition-agriculture specialists

Resulting probabilities: `Income: 0.30, Production: 0.25, Empowerment: 0.20, Integrated: 0.25`

## Step 3: Specify Interventions and Outcomes

Four candidate interventions:
- Homestead food production (vegetables, small livestock)
- Biofortified staple crops (orange sweet potato, iron beans)
- Women's empowerment + agriculture training
- Climate-smart agriculture integration

Outcomes across four SDGs:
- SDG 2: Dietary diversity score (0-10)
- SDG 3: Child height-for-age Z-score
- SDG 5: Women's empowerment index (0-1)
- SDG 13: Carbon sequestration (tons/ha/year)

## Step 4: Compute Expected Utilities

Using data from pilot studies and expert judgment, we estimate outcomes for each intervention under each causal model.

## Step 5: Compute EVECA and Make Decisions

```{r cgiar-case-study}
# CGIAR case study analysis
cgiar_analysis <- example_development(
  context = "agriculture",
  n_decisions = 4,
  n_models = 4,
  n_outcomes = 4,
  sdg_weights = c(0.35, 0.35, 0.20, 0.10),
  seed = 2024
)

# Results
cat("CGIAR Nutrition-Sensitive Agriculture Case Study\n")
cat("================================================\n")
cat("EVECA:", round(cgiar_analysis$evca_result$evca, 3), "\n")
cat("Optimal intervention:", cgiar_analysis$decision_names[cgiar_analysis$evca_result$optimal_decision_bma], "\n")
cat("Model probabilities:", round(cgiar_analysis$model_probs, 3), "\n\n")

cat("Decision Recommendations:\n")
cat("1. Implement", cgiar_analysis$decision_names[cgiar_analysis$evca_result$optimal_decision_bma], "while ambiguity persists

## 2. Utility Functions

- Choose utility functions appropriate for development contexts (e.g., equity-weighted, threshold-based)
- Consider stakeholder values and SDG trade-offs
- Test utility functions with simple inputs to ensure they work correctly

## 3. Interpretation for Development Decisions

- EVECA represents the maximum willingness to invest in research to resolve causal ambiguity
- Compare EVECA to the cost of impact evaluations, process studies, or causal mechanism research
- Consider sensitivity of results to model probabilities and stakeholder weights
- Use EVECA to guide adaptive management and learning investments

## 4. Integration with Development Evaluation Packages

The `evca` package is designed to work with development evaluation tools:

```{r integration-tools, eval=FALSE}
# Example: Integration with impact evaluation packages
# library(ImpactEvaluation)
# impact_data <- load_impact_data("evaluation_results.rds")
# model_utilities <- extract_utilities(impact_data, causal_models = c("M1", "M2", "M3"))

# Example: Integration with Bayesian analysis packages
# library(bayesm)
# model_probs <- bayesian_model_averaging(data, models = c("income", "production", "empowerment"))

# Example: Integration with SDG monitoring packages
# library(SDG)
# sdg_indicators <- compute_sdg_indicators(intervention_data)
# model_outcomes <- map_to_sdg_outcomes(sdg_indicators, causal_models)
```

# Conclusion

The `evca` package provides a decision-theoretic framework for valuing causal clarity in development and agriculture interventions. By quantifying the Expected Value of Eliminating Causal Ambiguity, EVECA helps development organizations make better decisions under structural uncertainty while investing wisely in the learning needed for future decisions.

## Key Applications for Development Practitioners:

1. **Research prioritization**: Allocate resources between parameter refinement and causal clarification research
2. **Program design**: Choose interventions robust to causal ambiguity while investing in learning
3. **Adaptive management**: Adjust programs as evidence accumulates about causal mechanisms
4. **Stakeholder engagement**: Make explicit the value trade-offs and uncertainties in development decisions
5. **Portfolio allocation**: Optimize resource allocation across interventions and contexts

## Key Features for Development Contexts:

- **Multi-dimensional outcomes**: Handle trade-offs across Sustainable Development Goals
- **Context adaptation**: Account for spatial and temporal heterogeneity in causal mechanisms
- **Stakeholder values**: Incorporate diverse perspectives through weighted utility functions
- **Practical implementation**: R package designed for development researchers and practitioners
- **Integration ready**: Works with existing evaluation methods and data systems

## Getting Started with EVECA in Your Organization:

1. **Start small**: Apply to one program or research portfolio
2. **Build capacity**: Train staff in decision analysis and Bayesian methods
3. **Integrate systems**: Link with existing M&E and planning processes
4. **Iterate and learn**: Refine models and probabilities as evidence accumulates
5. **Share learning**: Contribute to collective understanding of causal mechanisms in development

For development organizations operating under causal ambiguity—which is to say, all development organizations—EVECA offers a principled approach to answering critical questions: How much should we invest in understanding why our interventions work? Which causal uncertainties matter most for decision-making? How should we adapt our programs as we learn about causal mechanisms?

# References

## Value of Information and Decision Analysis
- Claxton, K. (1999). The irrelevance of inference: a decision-making approach to the stochastic evaluation of health care technologies. *Journal of Health Economics*, 18(3), 341-364.
- Yokota, F., & Thompson, K. M. (2004). Value of information analysis in environmental health risk management decisions: past, present, and future. *Risk Analysis*, 24(3), 635-650.
- Brennan, A., Kharroubi, S. A., O'Hagan, A., & Chilcott, J. (2007). Calculating partial expected value of perfect information via Monte Carlo sampling algorithms. *Medical Decision Making*, 27(4), 448-470.

## Causal Inference and Structural Uncertainty
- Pearl, J. (2009). *Causality: Models, Reasoning, and Inference* (2nd ed.). Cambridge University Press.
- Hernán, M. A., & Robins, J. M. (2020). *Causal Inference: What If*. Chapman & Hall/CRC.
- Cinelli, C., & Hazlett, C. (2020). Making sense of sensitivity: Extending omitted variable bias. *Journal of the Royal Statistical Society: Series B*, 82(1), 39-67.

## Bayesian Model Averaging
- Hoeting, J. A., Madigan, D., Raftery, A. E., & Volinsky, C. T. (1999). Bayesian model averaging: a tutorial. *Statistical Science*, 14(4), 382-401.
- Madigan, D., & Raftery, A. E. (1994). Model selection and accounting for model uncertainty in graphical models using Occam's window. *Journal of the American Statistical Association*, 89(428), 1535-1546.

## Development Economics and Impact Evaluation
- Banerjee, A. V., & Duflo, E. (2009). The experimental approach to development economics. *Annual Review of Economics*, 1(1), 151-178.
- Barrett, C. B., & Carter, M. R. (2010). The power and pitfalls of experiments in development economics: Some non-random reflections. *Applied Economic Perspectives and Policy*, 32(4), 515-548.
- Deaton, A. (2010). Instruments, randomization, and learning about development. *Journal of Economic Literature*, 48(2), 424-455.

## Nutrition-Sensitive Agriculture
- Ruel, M. T., & Alderman, H. (2013). Nutrition-sensitive interventions and programmes: how can they help to accelerate progress in improving maternal and child nutrition? *The Lancet*, 382(9891), 536-551.
- Kadiyala, S., Harris, J., Headey, D., Yosef, S., & Gillespie, S. (2014). Agriculture and nutrition in India: mapping evidence to pathways. *Annals of the New York Academy of Sciences*, 1331(1), 43-56.
- Ruel, M. T., Quisumbing, A. R., & Balagamwala, M. (2018). Nutrition-sensitive agriculture: What have we learned so far? *Global Food Security*, 17, 128-153.

## CGIAR and Agricultural Development
- Maredia, M. K., Shankar, B., Kelley, T. G., & Stevenson, J. R. (2014). Impact assessment of agricultural research, institutional innovation, and technology adoption: Introduction to the special section. *Food Policy*, 44, 214-217.
- CGIAR. (2020). *CGIAR 2030 Research and Innovation Strategy: Transforming Food, Land, and Water Systems in a Climate Crisis*. CGIAR System Organization.

## Multi-Criteria Decision Analysis in Development
- Hajkowicz, S., & Collins, K. (2007). A review of multiple criteria analysis for water resource planning and management. *Water Resources Management*, 21(9), 1553-1566.
- Mendoza, G. A., & Martins, H. (2006). Multi-criteria decision analysis in natural resource management: A critical review of methods and new modelling paradigms. *Forest Ecology and Management*, 230(1-3), 1-22.

## Software and Implementation
- Gelman, A., Carlin, J. B., Stern, H. S., Dunson, D. B., Vehtari, A., & Rubin, D. B. (2014). *Bayesian Data Analysis* (3rd ed.). Chapman & Hall/CRC.
- Wickham, H., Averick, M., Bryan, J., Chang, W., McGowan, L. D., François, R., ... & Yutani, H. (2019). Welcome to the tidyverse. *Journal of Open Source Software*, 4(43), 1686.
